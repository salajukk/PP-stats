<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PP Stats</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0d0f14;--surface:#161920;--surface2:#1e2230;--accent:#f0a500;--win:#3ecf8e;--loss:#e05a2b;--text:#e8eaf0;--muted:#7a8090;--border:#2a2f3e}
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh}
  header{background:linear-gradient(135deg,#0d0f14,#1a1f2e);border-bottom:1px solid var(--border);padding:28px 40px 20px;display:flex;align-items:flex-end;gap:24px;flex-wrap:wrap}
  .htitle{font-family:'Bebas Neue',sans-serif;font-size:3rem;letter-spacing:3px;color:var(--accent);line-height:1}
  .hsub{font-size:.85rem;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:4px}
  .badge{margin-left:auto;background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:10px 20px;text-align:center}
  .badge-num{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--win);letter-spacing:2px}
  .badge-lbl{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
  #loading{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:16px}
  .spinner{width:48px;height:48px;border:4px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .loading-text{color:var(--muted);font-size:.9rem;letter-spacing:1px}
  #error-msg{display:none;margin:40px;padding:24px;background:rgba(224,90,43,.1);border:1px solid var(--loss);border-radius:12px;color:var(--loss);line-height:1.8;font-size:.9rem}
  #error-msg a{color:var(--accent)}
  #app{display:none}
  nav{display:flex;gap:4px;padding:16px 40px;background:var(--surface);border-bottom:1px solid var(--border);overflow-x:auto;align-items:center}
  .tab{padding:8px 20px;border-radius:8px;border:none;background:transparent;color:var(--muted);font-family:'DM Sans',sans-serif;font-size:.85rem;font-weight:500;cursor:pointer;letter-spacing:.5px;white-space:nowrap;transition:all .2s}
  .tab:hover{color:var(--text);background:var(--surface2)}
  .tab.active{background:var(--accent);color:#0d0f14;font-weight:600}
  .season-select{margin-left:auto;background:var(--surface2);border:1px solid var(--border);color:var(--text);font-family:'DM Sans',sans-serif;font-size:.85rem;padding:6px 14px;border-radius:8px;cursor:pointer;outline:none}
  .section{display:none;padding:32px 40px}
  .section.active{display:block}
  h2{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px;color:var(--accent);margin-bottom:6px}
  .sdesc{color:var(--muted);font-size:.85rem;margin-bottom:24px}
  .chip-row{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px}
  .chip-label{font-size:.8rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
  .chip{padding:6px 16px;border-radius:20px;border:1.5px solid var(--border);background:var(--surface2);color:var(--muted);font-size:.8rem;cursor:pointer;transition:all .2s;font-family:'DM Sans',sans-serif}
  .chip:hover{border-color:var(--accent);color:var(--text)}
  .chip.on{color:#0d0f14;font-weight:600;border-color:transparent}
  .radar-wrap{max-width:520px;margin:0 auto}
  .cbox{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px}
  .team-wrap{max-width:820px}
  .sg{display:grid;grid-template-columns:repeat(auto-fill,minmax(215px,1fr));gap:16px}
  .sc{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:18px;transition:border-color .2s}
  .sc:hover{border-color:var(--accent)}
  .sc-name{font-weight:600;font-size:.95rem;margin-bottom:12px}
  .bl{display:flex;justify-content:space-between;font-size:.75rem;color:var(--muted);margin-bottom:4px}
  .bt{background:var(--surface2);border-radius:4px;height:8px;margin-bottom:10px;overflow:hidden}
  .bf{height:100%;border-radius:4px;transition:width .6s}
  .bfg{background:var(--accent)}.b3p{background:#5b8dee}
  .big{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;color:var(--accent);letter-spacing:1px}
  .biglbl{font-size:.7rem;color:var(--muted);text-transform:uppercase}
  .twrap{overflow-x:auto}
  table{width:100%;border-collapse:collapse;font-size:.85rem}
  th{background:var(--surface2);color:var(--muted);font-weight:500;text-transform:uppercase;font-size:.7rem;letter-spacing:1px;padding:10px 12px;text-align:right;cursor:pointer;user-select:none;white-space:nowrap}
  th:first-child{text-align:left}
  th:hover{color:var(--accent)}
  th.sa::after{content:' ‚ñ≤'}th.sd::after{content:' ‚ñº'}
  td{padding:10px 12px;text-align:right;border-bottom:1px solid var(--border)}
  td:first-child{text-align:left;font-weight:500}
  tr:hover td{background:var(--surface)}
  .hl{color:var(--accent);font-weight:600}
  .upd{font-size:.75rem;color:var(--muted);margin-top:12px;text-align:right}
  @media(max-width:600px){
    header{padding:20px}.htitle{font-size:2rem}
    nav{padding:12px 16px}.section{padding:20px 16px}
    .mobile-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:8px}
    .mobile-scroll .cbox{min-width:600px}
    .mobile-hint{font-size:.72rem;color:var(--muted);margin-bottom:8px;display:block}
  }
  @media(min-width:601px){.mobile-hint{display:none}}
</style>
</head>
<body>
<header>
  <div><div class="hsub">Tilastot</div><div class="htitle">PP Stats</div></div>
  <div class="badge"><div class="badge-num" id="record">‚Äì</div><div class="badge-lbl">Sarja</div></div>
</header>
<div id="loading"><div class="spinner"></div><div class="loading-text">Ladataan Google Sheetsist√§‚Ä¶</div></div>
<div id="error-msg">
  <strong>‚ö†Ô∏è Dataa ei voitu ladata.</strong><br><br>
  Varmista ett√§ Google Sheet on julkinen (Jaa ‚Üí Kuka tahansa linkill√§ ‚Üí Katselija)<br><br>
  <a href="https://docs.google.com/spreadsheets/d/1FKKi68DYKU4ABToYjN50HLhT8hOc06cIKNWNHWa8RYA" target="_blank">Avaa sheet ‚Üí</a>
</div>
<div id="app">
  <nav>
    <button class="tab active" onclick="showTab('radar',this)">üï∏ Pelaajaprofiilit</button>
    <button class="tab" onclick="showTab('timeline',this)">üìà Pistekehitys</button>
    <button class="tab" onclick="showTab('team',this)">üèÄ Joukkue</button>
    <button class="tab" onclick="showTab('shooting',this)">üéØ Heittotehokkuus</button>
    <button class="tab" onclick="showTab('tbl',this)">üìä Tilastot</button>
    <select class="season-select" id="seasonSel" onchange="changeSeason()"></select>
  </nav>
  <section id="radar" class="section active">
    <h2>Pelaajaprofiilit</h2><p class="sdesc">Vertaile kahta pelaajaa kuudella osa-alueella.</p>
    <div class="chip-label">Pelaaja 1</div><div class="chip-row" id="c1"></div>
    <div class="chip-label" style="margin-top:8px">Pelaaja 2</div><div class="chip-row" id="c2"></div>
    <div class="radar-wrap" style="margin-top:20px"><div class="cbox"><canvas id="radarC"></canvas></div></div>
  </section>
  <section id="timeline" class="section">
    <h2>Pistekehitys ottelusta toiseen</h2><p class="sdesc">Valitse pelaajat.</p>
    <div class="chip-row" id="tlChips"></div>
    <span class="mobile-hint">üëÜ Voit vieritt√§√§ kaaviota sivusuunnassa</span>
    <div class="mobile-scroll"><div class="cbox"><canvas id="tlC" height="180"></canvas></div></div>
  </section>
  <section id="team" class="section">
    <h2>Joukkueen tulokset</h2><p class="sdesc">Vihre√§ = voitto, oranssi = tappio.</p>
    <span class="mobile-hint">üëÜ Voit vieritt√§√§ kaaviota sivusuunnassa</span>
    <div class="mobile-scroll"><div class="cbox team-wrap"><canvas id="teamC" height="180"></canvas></div></div>
    <p class="upd" id="upd"></p>
  </section>
  <section id="shooting" class="section">
    <h2>Heittotehokkuus</h2><p class="sdesc">FG% ja 3PT% per pelaaja.</p>
    <div class="sg" id="sg"></div>
  </section>
  <section id="tbl" class="section">
    <h2>Tilastotaulukko</h2><p class="sdesc">Klikkaa saraketta j√§rjest√§√§ksesi.</p>
    <div class="twrap"><table><thead><tr>
      <th onclick="srt('Nimi')">Pelaaja</th><th onclick="srt('Pelit')">GP</th>
      <th onclick="srt('PPG')">PPG</th><th onclick="srt('RPG')">RPG</th>
      <th onclick="srt('APG')">APG</th><th onclick="srt('SPG')">SPG</th>
      <th onclick="srt('BPG')">BPG</th><th onclick="srt('TOPG')">TO</th>
      <th onclick="srt('FGp')">FG%</th><th onclick="srt('P3p')">3PT%</th>
      <th onclick="srt('AT')">AST/TO</th><th onclick="srt('EFF')">EFF</th>
    </tr></thead><tbody id="tb"></tbody></table></div>
  </section>
</div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxeFJaBz1s2qHb8II4uzQOVwfjlSSXkpRDwpDY4Mhvj_C3C7GxgtalBtFrotGR4zjPDeQ/exec';
const PAL = ['#f0a500','#5b8dee','#3ecf8e','#e05a2b','#c084fc','#f472b6','#34d399','#fb923c','#60a5fa','#a78bfa','#fbbf24','#4ade80'];

const COL = {
  nimi:'Nimi', ottelu:'Ottelunumero', vastustaja:'Vastustaja',
  pisteet:'Pisteet', kotiv:'Koti/Vieras', tulos:'Lopputulos',
  kausi:'Kausi', sarja:'Sarja/Harjoitus',
  omaPts:'Omat pisteet', vastPts:'Vastustajan pisteet',
  fgm:'FGM', fga:'FGA', t3m:'3PTM', t3a:'3PTA',
  ftm:'FTM', fta:'FTA', orb:'ORB', drb:'DRB', rb:'RB',
  ast:'AST', stl:'STL', blk:'BLK', to:'TO', pf:'PF'
};

let allRows=[], seasons=[], curSeason='';
let pStats={}, gData={}, tGames=[], players=[];
let r1='', r2='', tlSel=new Set();
let rChart, tlChart, tmChart;
let sKey='EFF', sDesc=true;

// ‚îÄ‚îÄ Fetch Apps Scriptist√§ (ei CORS-ongelmia) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadData() {
  try {
    const res = await fetch(APPS_SCRIPT_URL);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    allRows = await res.json();
    initApp();
  } catch(e) {
    showError('Virhe: ' + e.message);
  }
}

function showError(msg) {
  document.getElementById('loading').style.display = 'none';
  const el = document.getElementById('error-msg');
  el.style.display = 'block';
  el.innerHTML += '<br><small style="opacity:.7">Tekninen tieto: ' + msg + '</small>';
}

function n(v){ return (v==null||isNaN(v)) ? 0 : +v; }

function processSeason(s){
  const rows = allRows.filter(r => r[COL.kausi]===s && r[COL.sarja]==='Sarja');
  const gm = {};
  rows.forEach(r => { const k=r[COL.ottelu]; if(!gm[k]) gm[k]=r; });
  tGames = Object.values(gm).sort((a,b) => a[COL.ottelu]-b[COL.ottelu]);

  const pm = {};
  rows.forEach(r => {
    const nm = r[COL.nimi]; if(!nm) return;
    if(!pm[nm]) pm[nm]={gs:new Set(),pts:0,fgm:0,fga:0,t3m:0,t3a:0,ftm:0,fta:0,rb:0,orb:0,ast:0,stl:0,blk:0,to:0,pf:0,hasAdv:false};
    const p = pm[nm];
    p.gs.add(r[COL.ottelu]);
    p.pts += n(r[COL.pisteet]);
    if(r[COL.fgm] != null) p.hasAdv = true;
    p.fgm+=n(r[COL.fgm]); p.fga+=n(r[COL.fga]);
    p.t3m+=n(r[COL.t3m]); p.t3a+=n(r[COL.t3a]);
    p.ftm+=n(r[COL.ftm]); p.fta+=n(r[COL.fta]);
    p.rb+=n(r[COL.rb]);   p.orb+=n(r[COL.orb]);
    p.ast+=n(r[COL.ast]); p.stl+=n(r[COL.stl]);
    p.blk+=n(r[COL.blk]); p.to+=n(r[COL.to]); p.pf+=n(r[COL.pf]);
  });

  pStats = {};
  Object.entries(pm).forEach(([nm,p]) => {
    const g = p.gs.size;
    const eff = p.pts+p.rb+p.ast+p.stl+p.blk-p.to-(p.fga-p.fgm)-(p.fta-p.ftm);
    pStats[nm] = {
      Pelit:g, PPG:+(p.pts/g).toFixed(1), RPG:+(p.rb/g).toFixed(1),
      APG:+(p.ast/g).toFixed(1), SPG:+(p.stl/g).toFixed(1), BPG:+(p.blk/g).toFixed(1),
      TOPG:+(p.to/g).toFixed(1), FGp:p.fga>0?+(p.fgm/p.fga*100).toFixed(1):0,
      P3p:p.t3a>0?+(p.t3m/p.t3a*100).toFixed(1):0, P3a:+(p.t3a/g).toFixed(1),
      AT:p.to>0?+(p.ast/p.to).toFixed(2):0, EFF:+(eff/g).toFixed(1), hasAdv:p.hasAdv
    };
  });

  gData = {};
  rows.forEach(r => {
    const nm = r[COL.nimi]; if(!nm) return;
    if(!gData[nm]) gData[nm]=[];
    gData[nm].push({g:r[COL.ottelu], pts:n(r[COL.pisteet]), opp:r[COL.vastustaja]});
  });
  Object.values(gData).forEach(a => a.sort((x,y) => x.g-y.g));
  players = Object.keys(pStats).sort();
}

function initApp(){
  seasons = [...new Set(allRows.map(r=>r[COL.kausi]).filter(Boolean))].sort().reverse();
  const sel = document.getElementById('seasonSel');
  seasons.forEach(s => { const o=document.createElement('option'); o.value=s; o.textContent=s; sel.appendChild(o); });
  curSeason = seasons[0];
  processSeason(curSeason);
  r1=players[0]; r2=players[1];
  tlSel = new Set(players.slice(0,3));
  updateRecord();
  buildRadarChips(); buildRadar();
  buildTlChips(); buildTimeline();
  buildTeamChart(); buildSG(); renderTable();
  const now = new Date();
  document.getElementById('upd').textContent = `P√§ivitetty ${now.toLocaleDateString('fi-FI')} klo ${now.toLocaleTimeString('fi-FI',{hour:'2-digit',minute:'2-digit'})}`;
  document.getElementById('loading').style.display='none';
  document.getElementById('app').style.display='block';
}

function changeSeason(){
  curSeason = document.getElementById('seasonSel').value;
  processSeason(curSeason);
  r1=players[0]; r2=players[1]; tlSel=new Set(players.slice(0,3));
  updateRecord(); buildRadarChips(); buildRadar();
  buildTlChips(); buildTimeline(); buildTeamChart(); buildSG(); renderTable();
}

function updateRecord(){
  const w=tGames.filter(g=>g[COL.tulos]==='Voitto').length;
  const l=tGames.filter(g=>g[COL.tulos]==='Tappio').length;
  document.getElementById('record').textContent=`${w}‚Äì${l}`;
}

const RK=['PPG','RPG','APG','SPG','BPG','FGp','AT'];
const RL=['Pisteet','Levypallot','Sy√∂t√∂t','Riistot','Blokit','FG%','AST/TO'];
function norm(k,v){ const mx=Math.max(...players.map(p=>pStats[p]?.[k]||0)); return mx>0?Math.round(v/mx*100):0; }

function buildRadarChips(){
  [['c1',0],['c2',1]].forEach(([id,idx]) => {
    const el=document.getElementById(id); el.innerHTML='';
    players.forEach((p,i) => {
      const cur=idx===0?r1:r2;
      const ch=document.createElement('button');
      ch.className='chip'+(p===cur?' on':'');
      if(p===cur) ch.style.background=PAL[i%PAL.length];
      ch.textContent=p;
      ch.onclick=()=>{ if(idx===0) r1=p; else r2=p; buildRadarChips(); buildRadar(); };
      el.appendChild(ch);
    });
  });
}

function buildRadar(){
  const ctx=document.getElementById('radarC').getContext('2d');
  const d1=pStats[r1]||{}, d2=pStats[r2]||{};
  if(rChart) rChart.destroy();
  rChart=new Chart(ctx,{type:'radar',data:{labels:RL,datasets:[
    {label:r1,data:RK.map(k=>norm(k,d1[k]||0)),borderColor:'#f0a500',backgroundColor:'rgba(240,165,0,.15)',pointBackgroundColor:'#f0a500',borderWidth:2},
    {label:r2,data:RK.map(k=>norm(k,d2[k]||0)),borderColor:'#5b8dee',backgroundColor:'rgba(91,141,238,.15)',pointBackgroundColor:'#5b8dee',borderWidth:2}
  ]},options:{responsive:true,
    scales:{r:{min:0,max:100,ticks:{display:false},grid:{color:'rgba(255,255,255,.08)'},pointLabels:{color:'#e8eaf0',font:{family:"'DM Sans'",size:12}},angleLines:{color:'rgba(255,255,255,.08)'}}},
    plugins:{legend:{labels:{color:'#e8eaf0',font:{family:"'DM Sans'",size:12}}}}}});
}

function buildTlChips(){
  const el=document.getElementById('tlChips'); el.innerHTML='';
  players.forEach((p,i) => {
    const ch=document.createElement('button');
    ch.className='chip'+(tlSel.has(p)?' on':'');
    if(tlSel.has(p)) ch.style.background=PAL[i%PAL.length];
    ch.textContent=p;
    ch.onclick=()=>{ tlSel.has(p)?tlSel.delete(p):tlSel.add(p); buildTlChips(); buildTimeline(); };
    el.appendChild(ch);
  });
}

function buildTimeline(){
  const ctx=document.getElementById('tlC').getContext('2d');
  const gns=tGames.map(g=>g[COL.ottelu]);
  const labels=tGames.map(g=>`O${g[COL.ottelu]} ${(g[COL.vastustaja]||'').split(' ')[0]}`);
  const datasets=[...tlSel].map(p => {
    const col=PAL[players.indexOf(p)%PAL.length];
    const pts=gns.map(gn => { const e=(gData[p]||[]).find(d=>d.g===gn); return e?e.pts:null; });
    return{label:p,data:pts,borderColor:col,backgroundColor:col+'33',pointBackgroundColor:col,tension:.3,spanGaps:true,borderWidth:2,pointRadius:5,pointHoverRadius:7};
  });
  if(tlChart) tlChart.destroy();
  tlChart=new Chart(ctx,{type:'line',data:{labels,datasets},options:{
    responsive:true, maintainAspectRatio:true,
    plugins:{legend:{labels:{color:'#e8eaf0',font:{family:"'DM Sans'",size:12},boxWidth:12,padding:16}},tooltip:{mode:'index',intersect:false}},
    scales:{
      x:{ticks:{color:'#7a8090',font:{size:11},maxRotation:45,minRotation:30},grid:{color:'rgba(255,255,255,.05)'}},
      y:{ticks:{color:'#7a8090'},grid:{color:'rgba(255,255,255,.05)'},title:{display:true,text:'Pisteet',color:'#7a8090'}}
    }
  }});
}

function buildTeamChart(){
  const ctx=document.getElementById('teamC').getContext('2d');
  const labels=tGames.map(g=>`O${g[COL.ottelu]} ${(g[COL.vastustaja]||'').split(' ')[0]}`);
  const ppC=tGames.map(g=>g[COL.tulos]==='Voitto'?'#3ecf8e':'#e05a2b');
  const opC=tGames.map(g=>g[COL.tulos]==='Voitto'?'rgba(62,207,142,.3)':'rgba(224,90,43,.4)');
  if(tmChart) tmChart.destroy();
  tmChart=new Chart(ctx,{type:'bar',data:{labels,datasets:[
    {label:'PP Pisteet',data:tGames.map(g=>n(g[COL.omaPts])),backgroundColor:ppC,borderRadius:4},
    {label:'Vastustaja',data:tGames.map(g=>n(g[COL.vastPts])),backgroundColor:opC,borderRadius:4}
  ]},options:{
    responsive:true, maintainAspectRatio:true,
    plugins:{legend:{labels:{color:'#e8eaf0',font:{family:"'DM Sans'"},boxWidth:12,padding:16}},
      tooltip:{callbacks:{title:ctx=>{ const g=tGames[ctx[0].dataIndex]; return `${g[COL.vastustaja]} (${g[COL.tulos]})`; }}}},
    scales:{
      x:{ticks:{color:'#7a8090',font:{size:11},maxRotation:45,minRotation:30},grid:{display:false}},
      y:{ticks:{color:'#7a8090'},grid:{color:'rgba(255,255,255,.05)'},min:0}
    }
  }});
}

function buildSG(){
  const el=document.getElementById('sg'); el.innerHTML='';
  const adv=players.filter(p=>pStats[p].hasAdv);
  if(!adv.length){ el.innerHTML='<p style="color:var(--muted);padding:20px">Ei edistyneit√§ tilastoja t√§ll√§ kaudella.</p>'; return; }
  adv.sort((a,b)=>(pStats[b].FGp||0)-(pStats[a].FGp||0)).forEach(p => {
    const d=pStats[p];
    el.innerHTML+=`<div class="sc"><div class="sc-name">${p}</div>
      <div style="display:flex;gap:12px;margin-bottom:14px">
        <div><div class="big">${d.PPG}</div><div class="biglbl">PPG</div></div>
        <div style="margin-left:auto;text-align:right"><div style="font-size:.75rem;color:var(--muted)">${d.Pelit} peli√§</div><div style="font-size:.75rem;color:var(--muted)">EFF ${d.EFF}</div></div>
      </div>
      <div class="bl"><span>FG%</span><span>${d.FGp}%</span></div><div class="bt"><div class="bf bfg" style="width:${d.FGp}%"></div></div>
      <div class="bl"><span>3PT%</span><span>${d.P3p}%</span></div><div class="bt"><div class="bf b3p" style="width:${d.P3p}%"></div></div>
      <div class="bl"><span>3PA/peli</span><span>${d.P3a}</span></div></div>`;
  });
}

function renderTable(){
  const keys=['PPG','RPG','APG','SPG','BPG','FGp','P3p','AT','EFF'];
  const mx={};
  keys.forEach(k=>mx[k]=Math.max(...players.map(p=>pStats[p]?.[k]||0)));
  const data=players.map(p=>({Nimi:p,...pStats[p]}));
  data.sort((a,b)=>{ const av=a[sKey]??0,bv=b[sKey]??0; if(sKey==='Nimi') return sDesc?b.Nimi.localeCompare(a.Nimi):a.Nimi.localeCompare(b.Nimi); return sDesc?bv-av:av-bv; });
  document.getElementById('tb').innerHTML=data.map(r=>`<tr>
    <td>${r.Nimi}</td><td>${r.Pelit}</td>
    <td class="${r.PPG===mx.PPG?'hl':''}">${r.PPG}</td><td class="${r.RPG===mx.RPG?'hl':''}">${r.RPG}</td>
    <td class="${r.APG===mx.APG?'hl':''}">${r.APG}</td><td class="${r.SPG===mx.SPG?'hl':''}">${r.SPG}</td>
    <td class="${r.BPG===mx.BPG?'hl':''}">${r.BPG}</td><td>${r.TOPG}</td>
    <td class="${r.FGp===mx.FGp?'hl':''}">${r.FGp}%</td><td class="${r.P3p===mx.P3p?'hl':''}">${r.P3p}%</td>
    <td class="${r.AT===mx.AT?'hl':''}">${r.AT}</td><td class="${r.EFF===mx.EFF?'hl':''}">${r.EFF}</td>
  </tr>`).join('');
  document.querySelectorAll('th').forEach(t=>t.classList.remove('sa','sd'));
  const ks=['Nimi','Pelit','PPG','RPG','APG','SPG','BPG','TOPG','FGp','P3p','AT','EFF'];
  const idx=ks.indexOf(sKey);
  if(idx>=0) document.querySelectorAll('th')[idx].classList.add(sDesc?'sd':'sa');
}

function srt(k){ if(sKey===k) sDesc=!sDesc; else{sKey=k;sDesc=true;} renderTable(); }

function showTab(id,btn){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

loadData();
</script>
</body>
</html>
